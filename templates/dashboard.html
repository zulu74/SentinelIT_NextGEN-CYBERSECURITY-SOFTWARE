<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SentinelIT Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='ml.css') }}">
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
</head>
<body>
    <header>
        <h1>Welcome, {{ user.email }} ({{ user.role }})</h1>
        <nav>
            <a href="{{ url_for('logout') }}">Logout</a>
        </nav>
    </header>

    <section class="metrics">
        <h2>📊 System Metrics</h2>
        <ul id="live-metrics">
            <li>CPU Usage: {{ metrics['cpu'] }}%</li>
            <li>Memory Usage: {{ metrics['memory'] }}%</li>
            <li>Disk Usage: {{ metrics['disk'] }}%</li>
            <li>Net Sent: {{ metrics['sent'] }} bytes</li>
            <li>Net Received: {{ metrics['recv'] }} bytes</li>
            <li>Timestamp: {{ metrics['timestamp'] }}</li>
        </ul>
    </section>

    <section class="users">
        <h2>👥 Connected Users</h2>
        <table>
            <thead>
                <tr>
                    <th>Email</th>
                    <th>Role</th>
                    <th>Connected</th>
                    <th>Created At</th>
                </tr>
            </thead>
            <tbody>
                {% for u in users %}
                <tr>
                    <td>{{ u.email }}</td>
                    <td>{{ u.role }}</td>
                    <td>{{ '✅' if u.is_connected else '❌' }}</td>
                    <td>{{ u.created_at.strftime('%Y-%m-%d %H:%M:%S') }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </section>

    <section class="modules">
        <h2>🧩 Active Modules</h2>
        <ul>
            {% for m in modules %}
            <li>{{ m.name }}: {{ m.status }} (Last update: {{ m.last_update.strftime('%Y-%m-%d %H:%M:%S') }})</li>
            {% endfor %}
        </ul>
    </section>

    <script>
        const socket = io();
        socket.on('metrics', data => {
            const list = document.getElementById('live-metrics');
            list.innerHTML = `
                <li>CPU Usage: ${data.cpu}%</li>
                <li>Memory Usage: ${data.memory}%</li>
                <li>Disk Usage: ${data.disk}%</li>
                <li>Net Sent: ${data.sent} bytes</li>
                <li>Net Received: ${data.recv} bytes</li>
                <li>Timestamp: ${data.timestamp}</li>
            `;
        });
    </script>
</body>
</html>